<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script type="text/javascript">
        /*
            jquery가 제공하는 (Ajax관련) 함수에 대해 공부해보기
            - https://www.w3schools.com/jquery/jquery_ref_ajax.asp 
            - https://api.jquery.com/category/ajax/shorthand-methods 함수들 여기서 보기
        
            Ajax 관련 함수는 : xmlHttpRequest 객체를 사용하는 함수이다.
        
            종류로는, 
                - Global Ajax Event Handlers
                - Helper Functions
                - Low-Level Interface :모든 옵션을 개발자가 설정
                - Shorthand Methods :기본적인 설정(옵션이 셋팅되어 있음)
                
                ◆.load()
                The load() method loads data from a server and puts the returned data into the selected element. 
                -> 로드 함수는 데이터를 서버에서 가져오고(html, text형식) 넣는다. 넣고싶은 element에 자동으로! (innerHTML())단계까지 자동화 시킨 것
        
                -> .load( url [, data ] [, complete ] ) [] 는 생략가능하다. parameter를 1개 이상 쓰려면 쓸 수 있다.
        
                ▶url
                Type: String
                A string containing the URL to which the request is sent.
        
                ▶data(자바객체 OR String 문자열) parameter설정하는 것인데, ex) ?msg=hello
                Type: PlainObject(JSON) or String  // ex)json: {name:"lee", age:100} -> ?name=lee&age=100 으로 처리되어짐
                A plain object or string that is sent to the server with the request.
        
                ▶complete(callback함수, 자동호출) 4번 상태일 때 + 받아온 응답이 정상응답이라면, 자동으로 실행되는 함수 
                Type: Function( String responseText, String textStatus, jqXHR jqXHR )
                A callback function that is executed when the request completes.
                - responseText:  서버가 응답한 결과물을 받음 (html, text)
                - textStatus: 받아온 결과물이 정상값인지 아닌지 확인(정상이면(200), 비정상(404,500)) -> success(정상) OR error(에러) 를 return
                
                $( "#result" ).load( "ajax/test.html" ); -> load함수는 html을 가져와서(서버에서 받아온 데이터를) #result (넣고싶은 element) 에 넣어주기까지 한다.
                
                <!--비동기는 주석처리도 데이터를 인정하기 때문에 개발자도구 들어가서 Network의 Name부분에서 해당 파일을 선택하고 Response를 확인해보면 주석처리나 필요없는 데이터를 입력해서 그 값까지 넘어간 것을
                확인해볼 수 있다. 예상치 않은 데이터가 넘어왔을 때 확인해보면 좋을듯.-->
        
        */

        $(function () {
            $('#btn').click(function () {

                //$('#display').load("Ex01_Ajax_load.jsp"); //1줄로 비동기 끝ㅎㅎ;;
                //파라미터 3개를 다 받아보자
                $('#display').load("Ex01_Ajax_load2.jsp",
                    { "msg": $('#msg2').val() },//parameter로 json객체를 받아온 것
                    function (responseText, textStatus, xhr) {
                        //서버로부터 응답이 도착하면, 그 값이 정상값이라면 함수가 자동 호출된다. callback 함수이므로
                        //responseText -> 서버가 응답한 결과물을 받고 (html, text)
                        //textStatus는 정상값 판단
                        if (textStatus == "success") {
                            //응답이 도착했고(4번) 그 값이 정상값(status code = 200대) 이라면, 그 결과를 자동으로 #display에 넣어줌
                            alert("responseText : " + responseText);
                        } else {
                            //응답은 도착했으나, status 코드가 비정상 코드일 경우(에러일 경우) 500이나 404
                            alert("response fail: " + xhr.status + "/" + xhr.statusText); //무슨 에러인지 확인해보는 코드 굳이 해볼 필요는 없음
                        }

                    });

            });
        });
    </script>
</head>

<body>
    <h3>동기처리</h3>
    <div id="formsend">
        <form action="Ex01_Ajax_load.jsp" method="get">
            <input type="text" name="msg" id="msg">
            <input type="submit" value="동기전송">
        </form>
    </div>


    <h3>비동기처리</h3>
    <form action="Ex01_Ajax_load.jsp" method="get">
        <input type="text" name="msg2" id="msg2">
        <input type="button" id="btn" value="비동기전송">
    </form>
    <div id="display"></div>
</body>

</html>