<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>

        $(function () {
            // Total-call 카운팅 애니메이션
            // param ID, 시작, 종료, 경과시간
            function animateValue(id, start, end, duration) {
                var range = end - start;
                var current = start;
                var increment = end > start ? 1 : -1;
                var stepTime = Math.abs(Math.floor(duration / range));
                var obj = document.getElementById(id);
                var timer = setInterval(function () {
                    current += increment;
                    obj.innerHTML = $.number(current);
                    $("#total-call2").text($.number(current));	// 하단 수치를 보여주기 위해서 추가
                    if (current == end) {
                        clearInterval(timer);
                    }
                }, stepTime);
            }

            // 5분 마다 TotalCall 을 재호출
            function ajaxAutoTotalCall() {
                $.post("/ajaxMainTotalCall.do", function (totalCall) {
                    animateValue("total-call", totalCall.startValue, totalCall.endValue, 300000);
                }, "json");

                // 5분 후 재호출
                setTimeout(ajaxAutoTotalCall, 300000);
            }
            ajaxAutoTotalCall();
        }

    </script>
</head>

<body>
    <div class="api_calls">
        <div class="title">지금 호출되고 있는 누적 API calls</div>
        <dl>
            <dt>API calls</dt>
            <dd id="total-call"></dd>
        </dl>
    </div>
</body>

</html>